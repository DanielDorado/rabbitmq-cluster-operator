# Providing an external secret for default user credentials

By default, admin credentials for a RabbitmqCluster cluster are stored in a Kubernetes secret called
INSTANCE-default-user, where INSTANCE is the name of the RabbitmqCluster object.

There are some cases where you want to have the flexibility to specify your own credentials in a different secret. For
example, you may need to use tools like `ExternalSecret` operator which reads information from external APIs (like a
Cloud
secret provider) and automatically injects the values into a Kubernetes Secret.

The creation of this secret can delay, so the RabbitMQ cluster `StatefulSet` need to wait until the secret is created.

To do this we provide an option in the CRD called `externalsecret`:

```
apiVersion: rabbitmq.com/v1beta1
kind: RabbitmqCluster
metadata:
  name: external-secret-user
spec:
  secretBackend:
    externalSecret: 
      name: "my-secret"
```

When the `externalSecret` field is set, the default secret will not be generated by the cluster operator, and the
`StatefulSet` will wait until `my-secret` is generated.

The secret needs to be in the same format as our default-user secret, which adheres to
the [Service Binding Spec](https://servicebinding.io/spec/core/1.1.0/):

```
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
stringData:
  default_user.conf: |
    default_user = my-admin
    default_pass = super-secure-password
  host: dmF1bHQtZGVmYXVsdC11c2VyLmRlZmF1bHQuc3Zj
  username: my-admin
  password: super-secure-password
  port: "5672"
  provider: rabbitmq
  type: rabbitmq
```
